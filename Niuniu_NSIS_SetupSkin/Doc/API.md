

# API интерфейс

## 1. Инициализировать интерфейс
`InitSkinPage`
>Эта интерфейсная функция используется для инициализации
>nsNiuniuSkin.dll
>Управляйте информацией о конфигурации.
### Пример использования：
```nsis
nsNiuniuSkin::InitSkinPage "$PLUGINSDIR\" "${INSTALL_LICENCE_FILENAME}"
```
### Описание параметров：
| Номер параметра| Тип параметра | Описание параметра               | Примечание                                                        |
|------|------|--------------------|-------------------------------------------------------------|
| 1    | String  | Путь выпуска плагина, используемый для указания установочного пакета NSIS | Назначение этого пути очень важно. Подключаемые модули и пакеты ресурсов пользовательского интерфейса, указанные в сценарии, будут выпущены в этот каталог. Элемент управления интерфейса может вызывать отображение ресурса только после его правильного указания. |
| 2    | String  | Имя файла лицензионного соглашения          | Это текстовый файл, который будет загружен для отображения лицензионного соглашения при загрузке элементов управления интерфейсом.                          |



## 2. Название установочного пакета
`SetWindowTile`
> Эта  функция используется для указания заголовка установщика
### Пример  ：
```nsis
nsNiuniuSkin::SetWindowTile $hInstallDlg "Установка ${PRODUCT_NAME}"
```

### Описание параметров：
| Номер параметра | Тип параметра | Описание параметра | Замечания                   |
|------|------|----------------|---------------------------|
1 | Integer | Используется для указания дескриптора окна для установки заголовка | Возвращается при вызове init (дескриптор дочернего окна window) |
2 | String | Используется для указания заголовка установочного пакета |                          |


## 3. Устанавливает текущую отображаемую страницу "TAB"
`ShowPageItem`
> Эта интерфейсная функция используется для установки текущей отображаемой страницы TAB.
### Пример：
```nsis
nsNiuniuSkin::ShowPageItem $hInstallDlg  "wizardTab" ${INSTALL_PAGE_CONFIG}
```

### Описание параметров:：
| Номер параметра | Тип параметра | Описание параметра                     | Примечание                                         |
|----------|----------|------------------------------|----------------------------------------------|
| 1        | Integer     | Используется для указания дескриптора окна для установки заголовка | Возвращается при вызове init (сносный дескриптор окна маркера дочернего окна) |
| 2        | String   |Имя (name) указанного элемента TAB       |                                              |
| 3        | int      | Номер TAB вкладки для отображения         | 0 в качестве начального значения                              |



## 4. Интерфейс выбора пути установки
### 4.1 Уведомить интерфейс для просмотра пути установки
`SelectInstallDir`
```nsis
nsNiuniuSkin::SelectInstallDir
Pop $0
```
>  Уведомлений интерфейс, чтобы выбрать путь установки, и путь, чтобы добраться до переменной. Затем вызвать этот интерфейс, тогда вам следует вызвать **SetControlAttribute** , чтобы установить путь к интерфейсу управления.


## 5. Управления интерфейсом
```nsh
nsNiuniuSkin::ShowPage 0
```
> Когда событие привязки интерфейса завершено, через этот интерфейс вызывается управление отображением, и этот интерфейс блокируется и запускается.

### Описание параметров:：
| Номер параметра | Тип параметра | Описание параметра                       | Примечание                  |
|----------|----------|--------------------------------|-----------------------|
| 1        | Integer     | Функция NSIS, используемая для определения обратного вызова перед отображением | Если 0, это означает отсутствие обратного вызова |


## 6.  Всплывающий интерфейс с  подсказками

### 6.1 Следующий код используется для инициализации всплывающего окна дочернего окна и возврата его дескриптора:：
```nsis
nsNiuniuSkin::InitSkinSubPage "msgBox.xml" "btnOK" "btnCancel,btnClose"
pop $hInstallSubDlg
```

#### Описание параметров:：
| Номер параметра | Тип параметра | Описание параметра                                   | Примечание                                                         |
|----------|----------|--------------------------------------------|--------------------------------------------------------------|
| 1        | String   | Укажите XML-файл конфигурации пользовательского интерфейса, который будет использоваться для всплывающего окна.              |                                                              |
| 2        | String   | Укажите XML-файл конфигурации пользовательского интерфейса, который будет использоваться для всплывающего окна. |
| 3        | String   | Указывает идентификационный номер кнопки, которая возвращает IDCANCEL при выходе из всплывающего окна после нажатия кнопки | Если BindCallBack используется для привязки обратного вызова функции NSIS для этой кнопки, этот параметр недействителен |


### 6.2 Следующий код используется для установки свойств его элемента управления UI на основе дескриптора всплывающего окна для управления изменением отображения：
```nsis
nsNiuniuSkin::SetControlAttribute $hInstallSubDlg "lblTitle" "text" "Подсказка"
```

### 6.3 Следующий код показывает всплывающее окно：
```nsis
nsNiuniuSkin::ShowSkinSubPage 0
```

### Описание параметров:：
| Номер параметра | Тип параметра | Описание параметра                           | Примечание                |
|----------|----------|------------------------------------|---------------------|
| 1        | Integer     | Укажите адрес функции NSIS, которую нужно вызвать до отображения всплывающего окна. | Если 0 означает отсутствие обратного вызова; |


## 7. Свойства указанного элемента управления на указанном интерфейсе
```nsis
nsNiuniuSkin::SetControlAttribute $hInstallDlg "btnClose" "enabled" "false"
nsNiuniuSkin::SetControlAttribute $hInstallDlg "lblInstalling" "text" "Удаление ..."
```
>Этот интерфейс используется для указания указанных атрибутов указанного элемента интерфейса, таких как: доступность, видимость, выделение, текст, фоновое изображение и т. Д.

### Описание параметров:：
| Номер параметра | Тип параметра | Описание параметра                     | Примечание                                         |
|----------|----------|------------------------------|----------------------------------------------|
| 1        | Integer     | Используется для указания дескриптора окна для установки заголовка | Возвращается при вызове init (сносный дескриптор окна маркера дочернего окна) |
| 2        | String   | управления name                   |                                              |
| 3        | String   | Имя управляющего свойства                 |                                              |
| 4        | String   | Контролируеи значения свойств                 |                                              |

> Примечание:
Вы можете установить все общие свойства через этот интерфейс, обычно вы можете использовать этот интерфейс для установки текста указанного элемента управления, будь то доступный, видимый, положение, размер, фоновое изображение, цвет текста и т. Д., Например, его можно использовать для установки флажка и т. Д. и так далее.。



## 8. Получение общих свойства элемента управления
```nsis
nsNiuniuSkin::GetControlAttribute $hInstallDlg "editDir" "text"
Pop $2
```
> Этот интерфейс используется для получения указанных атрибутов указанных элементов интерфейса, таких как: доступность, видимость, текст и т. д.

### Описание параметров:：
| Номер параметра | Тип параметра | Описание параметра                     | Примечание                                         |
|----------|----------|------------------------------|----------------------------------------------|
| 1        | Integer     | Используется для указания дескриптора окна для установки заголовка | Возвращается при вызове init (сносный дескриптор окна маркера дочернего окна) |
| 2        | String   | управления name                   |                                              |
| 3        | String   | Имя управляющего свойства                 |                                              |


## 9. Связывание связанных событий в пользовательском интерфейсе
```nsis
GetFunctionAddress $0 OnExitDUISetup
nsNiuniuSkin::BindCallBack $hInstallDlg "btnClose" $0
```
>Этот интерфейс используется для привязки функции обратного вызова для нажатия кнопки или функции обратного вызова при изменении текста элемента управления **RichEdit**.

### Описание параметров:：
| Номер параметра | Тип параметра | Описание параметра                         | Примечание                                                                       |
|----------|----------|----------------------------------|----------------------------------------------------------------------------|
| 1        | Integer     | Используется для указания дескриптора окна для установки заголовка     | Возвращается при вызове init (сносный дескриптор окна маркера дочернего окна)                   |
| 2        | String   | Название кнопки или richedit управления в интерфейсе пользовательского интерфейса |                                                                            |
| 3        | LONG     | Адрес функции NSIS для привязки           | При нажатии кнопки с указанным именем или изменении содержимого указанного richedit сработает связанная функция |

> Примечание:
>> 1). Когда связанный элемент управления является элементом управления RichEdit, связанная функция запускается при изменении текстового содержимого, вы можете связать элемент управления путем и одновременно получить путь в связанной функции для вынесения юридического решения.

>> 2). Чтобы иметь возможность уведомить NSIS о событии закрытия окна с помощью Ctrl + F4 и закрытия окна на панели задач, здесь необходимо связать специальное имя：**syscommandclose**


## 10. Завершение установки
```nsh
nsNiuniuSkin::ExitDUISetup
```
>Когда этот интерфейс вызван, он выйдет из процесса установки

## 11. Вспомогательный интерфейс обработки строк
```nsis
nsNiuniuSkin::StringHelper "c:\test\test\" "\" "" "trimright"; Если последним символом исходной строки является \\, то они будут удалены
pop $0

nsNiuniuSkin::StringHelper "c:\AAA\dst" "AAA" "bbb" "replace"   ;Заменяет AAA в исходном коде на bbb
pop $0

nsNiuniuSkin::StringHelper "c:\AAA\dst" "\" "" " getrightbychar "   ; Возвращает последний абзац, разделенный \\ в исходном коде, в данном случае dst
pop $0
```
> Это вспомогательная функция, предназначенная для упрощения обработки строк в скриптах NSIS. Те, кому это нужно, могут использовать.

### Описание параметров:：

| Номер параметра | Тип параметра | Описание параметра                                       | Примечание                    |
|----------|----------|------------------------------------------------|-------------------------|
| 1        | String   | Строка, ожидающая обработки                    |                         |
| 2        | String   | Укажите значения параметров, которые необходимо использовать для вспомогательного запроса во время обработки источника |                         |
| 3        | String   | Целевая строка, подлежащая замене на String                      | Действителен только при replace инструкции |
| 4        | String   | Используется для указания типа операции, выполняемой со String               |   replace：Заменит значение второго параметра на значение третьего параметра в исходной строке, а затем вернет  его trimright：Удалить последний символ в исходной строке (если он равен второму аргументу)getrightbychar:Из исходной строки возьмет значение последнего сегмента, разделенное на второй аргумент   |


## 12. Дополнительная информация



### Для конкретного сценария NSIS и файла конфигурации DUILIB, пожалуйста, обратитесь к Примерам:
- 1). Ресурсы DUILIB должны быть упакованы в zip-архив, а имя должно быть skin.zip
- 2). В сценарии NSIS интерфейс установки и удаления указан следующим образом:

  - Каталог выпуска плагинов указывается здесь как путь к выпуску пакета ресурсов duilib и файла лицензионного соглашения.

- 3). В реальном процессе установки, чтобы сделать информацию о ходе выполнения максимально точной, используется метод декомпрессии 7z
  -Это требует, чтобы перед созданием установочного пакета вам нужно было упаковать файлы, которые нужно установить, в сжатый пакет 7z, а затем указать установку в NSIS

  -В NSIS есть соответствующие плагины 7z для распаковки, которые нужно вызывать в потоке, чтобы избежать зависания интерфейса.

- 4). Приведенные в настоящее время примеры включают только распространенные сценарии NSIS, относящиеся к интерфейсу пользовательского интерфейса, требуется дальнейшая обработка записи в конкретный реестр, резервное копирование файлов и другие операции, и вам необходимо самостоятельно написать другой сценарий NSIS.

- 5). Картинка при установке интерфейса поддерживает карусель, и интервал можно установить. Запись в XML выглядит следующим образом
